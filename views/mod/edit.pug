extends ../layout

block content
    section.my-5.mx-1
        div.card.mb-3
            div.card-body
                h5.card-title= 'Edit ' + mod.title
                if error
                    div.alert.alert-danger=error
                form(method='post' action='/mods/' + mod.id + '/edit').big-form
                    div.form-group
                        label(for='title') Title
                        input(type='text' placeholder='Mod Title' name='title' maxlength='255' value=formContents.title required).form-control#title
                    div.form-group
                        label(for='id') ID
                        input(type='text' placeholder='mod-identifier' name='id' aria-describedby='idHelp' maxlength='64' value=mod.id disabled='disabled').form-control#id
                        small.text-muted#idHelp This text will be used in the mod url.
                    div.form-group
                        label(for='update-url') Update URL
                        input(type='url' aria-describedby='updateUrlHelp' value=`${baseUrl}/api/v1/mods/${mod.id}/version.txt` disabled='disabled').form-control#update-url
                        small.text-muted#updateUrlHelp You can use this URL in the #[code ModVersionCheckUrl] attribute in your mod to enable update checking.
                    div.form-group
                        label(for='description') Description
                        input(type='text' placeholder='Short description for your mod.' name='description' maxlength='255' value=formContents.description required).form-control#description
                    div.form-group
                        label(for='banner') Banner image URL
                        input(type='url' placeholder='https://example.com/imagename.png' name='bannerImageUrl' aria-describedby='bannerHelp' value=formContents.bannerImageUrl).form-control#banner
                        small.text-muted#bannerHelp This image will be used when displaying your mod in the mods directory.
                    div.form-group
                        label(for='category') Category
                        select(name='category' required).custom-select#category
                            option(value='utility' selected=(formContents.category === 'utility')) Utility
                            option(value='optimization' selected=(formContents.category === 'optimization')) Optimization
                    div.form-group
                        label(for='readme-input') Readme
                        textarea(placeholder='Explain what your mod is about and how to use it using markdown.' name='readme' rows='10' required).form-control#readme-input=formContents.readme
                    div.form-group
                        label(for='repository') Source code repository URL
                        input(type='url' placeholder='https://github.com/path/to/repository' name='repositoryUrl' aria-describedby='repositoryHelp' value=formContents.repositoryUrl).form-control#repository
                        small.text-muted#repositoryHelp Can be left out.
                    div.form-group
                        label(for='originalWebsite') Original website URL
                        input(type='url' placeholder='https://example.com/mymod/' name='originalWebsiteUrl' aria-describedby='originalWebsiteHelp' value=formContents.originalWebsiteUrl).form-control#originalWebsite
                        small.text-muted#originalWebsiteHelp Can be left out.
                    hr
                    input(type='submit' value='Submit changes').btn.btn-success
                    button(type='button' data-toggle='collapse' data-target='#preview' aria-expanded='false' aria-controls='preview').mx-1.btn.btn-outline-primary Preview mod page
                    a(href='/mods/' + mod.id).btn.btn-outline-danger Discard changes
    include ../mod-preview
    section.my-5.mx-1
        div.card.mb-3.border-danger
            div.card-body
                h5.card-title Danger zone
                    | 
                    button(type='button' data-toggle='collapse' data-target='#danger-zone' aria-expanded='false' aria-controls='danger-zone').btn.btn-sm.float-right.btn-outline-danger Click to expand
                div.collapse#danger-zone
                    form(method='post' action='/mods/' + mod.id + '/edit')#transferForm.big-form
                        div.form-group
                            label(for='changeOwner') Transfer this mod to another owner
                            input(type='text' placeholder='username' name='changeOwner' aria-describedby='changeOwnerHelp' value='').form-control#changeOwner
                            small.text-muted#changeOwnerHelp Enter the username of the new owner.
                        input(type='button' value='Transfer mod' data-toggle='modal' data-target='#confirmModal' data-action='transfer').btn.btn-danger
                    hr
                    form(method='post' action='/mods/' + mod.id + '/edit')#deleteForm.big-form
                        div.form-group
                            label(for='deleteMod') Delete this mod
                            input(type='text' placeholder=mod.id name='deleteMod' aria-describedby='deleteModHelp' value='').form-control#deleteMod
                            small.text-muted#deleteModHelp Enter the id of this mod to begin the deletion process. The mod will be deleted after #{deletionInterval} days, unless you cancel the deletion. Mods can not be restored once the deletion is complete.
                        input(type='button' value='Delete mod' data-toggle='modal' data-target='#confirmModal' data-action='delete').btn.btn-danger
        ul
            li #[a(href=`/mods/${mod.id}`) Go back to the mod's page]
            li Want to publish an update for this mod? #[a(href=`/mods/${mod.id}/addversion`) Add a new version]
    script(src='https://cdn.rawgit.com/showdownjs/showdown/1.0.1/dist/showdown.min.js')

    div(tabindex='-1' role='dialog' aria-labelledby='confirmModalLabel' aria-hidden='true').modal.fade#confirmModal
        div(role='document').modal-dialog.modal-dialog-centered
            div.modal-content.border-0
                div.modal-header.border-bottom-0
                    h5.modal-title#confirmModalLabel Are you sure?
                    button(type='button' data-dismiss='modal' aria-label='Close').close
                        span(aria-hidden='true') &times;
                div.modal-body #[span#confirmModalText] 
                    | Only press continue if you know what you are doing!
                div.modal-footer.border-top-0
                    button(type='button')#confirmModalRedButton.btn.btn-outline-danger.btn-danger I know what I am doing, continue
                    button(type='button' data-dismiss='modal').btn.btn-success I've changed my mind
    script.
        var modalTargetForm;
        $("#confirmModal").on("show.bs.modal", function(event) {
            var button = $(event.relatedTarget);
            var action = button.data("action");
            var text;
            switch (action) {
                case "transfer":
                    modalTargetForm = $("#transferForm");
                    text = "You are about to transfer this mod to another user. This means that you will not be able to edit this mod again.";
                    break;
                case "delete":
                    modalTargetForm = $("#deleteForm");
                    text = "You are about to delete this mod. This means that it will be removed from our database. This action is irreversible!";
                    break;
                default:
                    modalTargetForm = undefined;
                    text = "We don't know what you did but somehow you are about to do something dangerous! Be careful!";
                    break;
            }
            $("#confirmModalText").text(text);
        });
        $("#confirmModalRedButton").click(function() {
            modalTargetForm.submit();
        });